# DART 공시 XML 파싱과 텍스트 추출 방법

---

### DART 공시 원문 XML 구조와 추출 방법

한국 금융감독원의 DART 전자공시 시스템에서는 정기보고서 원문을 XML 형태로 제공합니다. **OpenDART API**의 `document.xml` 엔드포인트를 사용하면 공시 원본 문서가 ZIP 파일로 다운로드되며, ZIP 내부에 공시 내용이 담긴 XML 파일들이 들어 있습니다. 예를 들어 사업보고서의 경우 텍스트 본문이 XML로 제공되는데, 이 XML 내부에는 여러 섹션의 제목(`<TITLE>`)과 본문 단락(`<P>`) 등이 계층적으로 포함되어 있습니다. XML 내용에는 문단 구분, 표(Table), 페이지 나누기(`<PGBRK>`) 등의 HTML 유사 구조가 섞여 있어 일반 텍스트와 태그 구조가 함께 존재합니다.

원본 XML를 다룰 때는 **인코딩**에 유의해야 합니다. 과거 공시 문서는 **EUC-KR**로 인코딩된 경우가 많기 때문에, 먼저 EUC-KR로 디코딩하고 실패하면 **UTF-8**로 시도하는 방식이 권장됩니다. OpenDART API로 받은 바이너리 ZIP 응답을 `zipfile`로 열어 XML 파일을 추출하고, 이렇게 얻은 XML 바이트를 위와 같이 한글 인코딩을 처리한 문자열로 변환합니다. 이후 이 문자열을 파싱하여 필요한 텍스트를 얻어낼 수 있습니다.

---

### 파싱을 위한 파이썬 라이브러리 선택

공시 XML의 텍스트를 추출하려면 적절한 XML/HTML 파싱 도구를 사용하는 것이 중요합니다. 선택지마다 장단점이 있으며, DART 공시 XML처럼 HTML 태그 구조를 포함한 XML에 대응하려면 아래 도구들이 활용됩니다:

* **`xml.etree.ElementTree`**:
  * 파이썬 표준 라이브러리로 제공되는 XML 파서로, 속도가 빠르고 메모리 효율적입니다.
  * 단, XML이 엄격한 트리 구조를 가져야 하며 HTML 형태의 깨진 태그가 있으면 파싱에 어려움이 있을 수 있습니다.
  * 대량의 문서를 처리하거나 성능이 중요할 경우 유효한 XML에서는 `xml.etree`를 고려할 수 있습니다.

* **`lxml`**:
  * XML과 HTML 파싱을 모두 지원하는 강력한 서드파티 라이브러리입니다.
  * `lxml`은 HTML parser를 사용할 수 있어서 형식이 약간 불완전한 옛날 공시 XML도 유연하게 처리할 수 있습니다.
  * DART 공시 XML처럼 HTML 태그가 섞인 문서는 `lxml`을 활용한 파싱이 안정적인 방법입니다.

* **`BeautifulSoup (bs4)`**:
  * HTML/XML 파싱에 널리 쓰이는 라이브러리로, 구문이 간단하고 태그 탐색이 직관적입니다.
  * 내부 파서로 `lxml`이나 `html.parser` 등을 지정할 수 있어 편리하지만, 대용량 문서에서는 속도가 느릴 수 있습니다.
  * 내부적으로 문자 인코딩 검사 등의 오버헤드가 있어 `xml.etree`보다 느리게 동작할 수 있습니다.

* **`xmltodict`**:
  * XML을 한 번에 Python 딕셔너리로 변환해주는 경량 유틸리티입니다.
  * 공시 XML에서 원하는 정보만 추출하거나 JSON 형태로 변환하고 싶을 때 유용합니다.
  * `xmltodict.parse(xml_string)` 호출로 쉽게 파싱할 수 있으나, 계층이 깊은 공시 원문에서는 변환된 딕셔너리가 매우 복잡해질 수 있습니다.

파싱 후 원하는 텍스트 추출을 위해 **XPath**를 사용하거나, 파싱한 트리에서 `<P>` 태그들을 순회하며 `.text` 속성으로 내용을 모으는 방법 등이 있습니다. 핵심은 문단(`<P>`) 단위의 내용을 수집하고 불필요한 태그(`<TABLE>`, `<PGBRK>` 등)는 제외하는 것입니다. `BeautifulSoup`의 `get_text()` 메서드나 `lxml`의 `etree.tostring(element, method="text")` 등을 사용하면 태그를 제거하고 순수 텍스트만 편리하게 추출할 수 있습니다.

---

### 기존 라이브러리와 파싱 사례

**`OpenDartReader`**와 **`dart-fss`** 같은 오픈소스 라이브러리가 DART API 활용을 쉽게 해주며, 원문 파일 파싱에도 도움을 줍니다.

* **`OpenDartReader`**: `dart.document(접수번호)` 함수를 통해 공시 원문 텍스트를 바로 가져올 수 있습니다. 인코딩 처리와 ZIP 해제가 완료된 상태라 사용자는 바로 파싱이나 검색을 하면 됩니다.
* **`dart-fss`**: `download_document(path, rcept_no)` 함수로 원본 ZIP 파일을 다운로드할 수 있지만, 파싱은 사용자가 직접 해야 하므로 앞서 언급한 파서들을 함께 활용해야 합니다.

개인이나 커뮤니티에서도 DART 공시 XML 파싱 사례를 많이 공유하고 있습니다.

* **사례 1 (문자열 검색 방식)**: 한 블로그에서는 OpenDART API로 사업보고서 ZIP을 받은 뒤, 모든 XML 파일을 EUC-KR/UTF-8로 디코딩하여 문자열 리스트를 만듭니다. 이후 원하는 섹션의 시작과 끝 제목 태그(예: `"II. 사업의 내용"</TITLE>`부터 `"III. 재무에 관한 사항"</TITLE>`까지)를 문자열 검색으로 찾아 해당 부분을 잘라내는 방식을 소개했습니다. 이 방법은 특정 섹션만 필요할 때 빠르게 적용할 수 있지만, 구조 변경에 약하고 범용성은 떨어집니다.

* **사례 2 (HTML 파서 활용)**: 다른 블로그에서는 오래된 공시 XML의 특이한 구조 때문에 `lxml`의 HTML 파서를 활용한 경험을 공유했습니다. 과거 공시는 전통적인 XML 스키마를 따르지 않아 XML 파서로 오류가 발생했는데, 이를 HTML로 간주하고 파싱하여 문제를 해결했다고 설명합니다. 이처럼 XML과 HTML을 모두 다룰 수 있는 파서를 선택하는 것이 중요합니다.

요약하면, DART 공시 XML의 텍스트 추출은 **(1) OpenDART API로 원본 XML ZIP 획득**, **(2) 적절한 파싱 도구로 XML 읽기**, **(3) 원하는 섹션이나 문단의 텍스트 추출** 단계로 진행합니다. 소규모 작업에는 간단한 문자열 처리도 가능하지만, 신뢰성과 확장성을 위해서는 `xml.etree`나 `lxml`, `BeautifulSoup` 같은 파서를 사용하는 것이 좋습니다. 이러한 방법들을 통해 공시 보고서의 텍스트 데이터를 추출하여, 이후 자연어 처리에 활용할 수 있습니다.
